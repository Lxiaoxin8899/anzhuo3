âš ï¸ æœ¬æ–‡æè¿°çš„æ˜¯ç”Ÿäº§æŠ•æ–™é˜¶æ®µå†…å®¹ï¼Œå·²å½’æ¡£ï¼Œä»…ä¾›å‚è€ƒã€‚

# ğŸ”§ Webç«¯ä¸­æ–‡æ˜¾ç¤ºé—®é¢˜ä¿®å¤ï¼ˆç¬¬äºŒæ¬¡ä¿®å¤ï¼‰

**é—®é¢˜**: Webç«¯æ‰€æœ‰ä¸­æ–‡ä»æ˜¾ç¤ºä¸ºé—®å·ï¼ˆ??????ï¼‰
**æ ¹æœ¬åŸå› **: Ktorçš„`respondHtml`æ–¹æ³•ä¸æ”¯æŒæ˜¾å¼è®¾ç½®å­—ç¬¦é›†
**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨`respondText`é…åˆ`createHTML`æ‰‹åŠ¨æ„å»ºHTMLå¹¶æ˜ç¡®æŒ‡å®šUTF-8
**çŠ¶æ€**: âœ… å·²ä¿®å¤

---

## ä¿®å¤è¯¦æƒ…

### é—®é¢˜åˆ†æ

ç¬¬ä¸€æ¬¡ä¿®å¤å°è¯•åœ¨`respondHtml`å‰è®¾ç½®headerï¼Œä½†Ktorçš„`respondHtml`ä¼šè¦†ç›–æˆ‘ä»¬çš„è®¾ç½®ã€‚

### æ­£ç¡®çš„è§£å†³æ–¹æ¡ˆ

ä½¿ç”¨`kotlinx.html.stream.createHTML()`ç”ŸæˆHTMLå­—ç¬¦ä¸²ï¼Œç„¶åç”¨`respondText`å‘é€ï¼Œå¹¶æ˜ç¡®æŒ‡å®šå­—ç¬¦é›†ä¸ºUTF-8ã€‚

### ä¿®æ”¹å†…å®¹

**æ–‡ä»¶**: `app/src/main/java/com/example/smartdosing/web/WebServerManager.kt`

**ä¿®æ”¹å‰**:
```kotlin
get("/") {
    call.respondHtml {
        generateMainPage()
    }
}
```

**ä¿®æ”¹å**:
```kotlin
get("/") {
    val htmlContent = kotlinx.html.stream.createHTML().html {
        generateMainPage()
    }
    call.respondText(htmlContent, ContentType.Text.Html.withCharset(Charsets.UTF_8))
}
```

### å…³é”®ç‚¹

1. ä½¿ç”¨`kotlinx.html.stream.createHTML()`ç”ŸæˆHTMLå­—ç¬¦ä¸²
2. ä½¿ç”¨`call.respondText()`è€Œä¸æ˜¯`call.respondHtml()`
3. æ˜ç¡®æŒ‡å®š`ContentType.Text.Html.withCharset(Charsets.UTF_8)`

---

## é‡æ–°å®‰è£…æ­¥éª¤

### 1. å¸è½½æ—§ç‰ˆæœ¬
```bash
adb uninstall com.example.smartdosing
```

### 2. å®‰è£…æ–°ç‰ˆæœ¬
```bash
adb install app/build/outputs/apk/debug/app-debug.apk
```

### 3. å¯åŠ¨åº”ç”¨
åœ¨è®¾å¤‡ä¸Šå¯åŠ¨SmartDosingåº”ç”¨

### 4. è·å–è®¾å¤‡IP
æŸ¥çœ‹åº”ç”¨å¯åŠ¨æ—¶çš„Toastæç¤ºï¼Œæˆ–æ‰§è¡Œï¼š
```bash
adb shell ip -f inet addr show wlan0 | findstr "inet"
```

### 5. æµè§ˆå™¨æµ‹è¯•
è®¿é—®ï¼š`http://[ä½ çš„è®¾å¤‡IP]:8080`

---

## éªŒè¯æ¸…å•

è®¿é—®ä»¥ä¸‹é¡µé¢ï¼Œç¡®è®¤ä¸­æ–‡æ˜¾ç¤ºæ­£å¸¸ï¼š

### âœ… é¦–é¡µæµ‹è¯•
è®¿é—®ï¼š`http://[IP]:8080/`

**åº”è¯¥çœ‹åˆ°**ï¼š
- é¡µé¢æ ‡é¢˜ï¼š"SmartDosing æ™ºèƒ½æŠ•æ–™ç³»ç»Ÿ - ç®¡ç†åå°"
- å¤§æ ‡é¢˜ï¼š"æ™ºèƒ½æŠ•æ–™ç³»ç»Ÿç®¡ç†åå°"
- å‰¯æ ‡é¢˜ï¼š"è½»æ¾ç®¡ç†é…æ–¹ï¼Œç²¾ç¡®æ§åˆ¶æŠ•æ–™"
- æŒ‰é’®ï¼š"è¿›å…¥é…æ–¹ç®¡ç†"ã€"å¯¼å…¥é…æ–¹"ã€"æŸ¥çœ‹ç»Ÿè®¡"

### âœ… å¯¼å…¥é¡µé¢æµ‹è¯•
è®¿é—®ï¼š`http://[IP]:8080/import`

**åº”è¯¥çœ‹åˆ°**ï¼š
- é¡µé¢æ ‡é¢˜ï¼š"é…æ–¹å¯¼å…¥"
- è¯´æ˜æ–‡å­—æ­£å¸¸
- æŒ‰é’®ï¼š"é€‰æ‹©æ–‡ä»¶"ã€"ä¸Šä¼ å¯¼å…¥"

### âœ… é…æ–¹ç®¡ç†æµ‹è¯•
è®¿é—®ï¼š`http://[IP]:8080/recipes`

**åº”è¯¥çœ‹åˆ°**ï¼š
- é¡µé¢æ ‡é¢˜ï¼š"é…æ–¹ç®¡ç†"
- è¡¨æ ¼åˆ—æ ‡é¢˜æ­£å¸¸
- é…æ–¹æ•°æ®ä¸­æ–‡æ­£å¸¸

### âœ… ç»Ÿè®¡é¡µé¢æµ‹è¯•
è®¿é—®ï¼š`http://[IP]:8080/stats`

**åº”è¯¥çœ‹åˆ°**ï¼š
- é¡µé¢æ ‡é¢˜ï¼š"ç»Ÿè®¡åˆ†æ"
- ç»Ÿè®¡æ•°æ®æ ‡ç­¾æ­£å¸¸

---

## æŠ€æœ¯è¯´æ˜

### ä¸ºä»€ä¹ˆç¬¬ä¸€æ¬¡ä¿®å¤æ— æ•ˆï¼Ÿ

Ktorçš„`respondHtml`æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ‰©å±•å‡½æ•°ï¼Œå®ƒåœ¨å†…éƒ¨å¤„ç†Content-Typeï¼Œä¼šè¦†ç›–æˆ‘ä»¬é¢„å…ˆè®¾ç½®çš„headerã€‚

### æ­£ç¡®çš„ä¿®å¤æ–¹å¼

1. **æ‰‹åŠ¨ç”ŸæˆHTML**: ä½¿ç”¨`createHTML()`å°†HTMLç»“æ„è½¬æ¢ä¸ºå­—ç¬¦ä¸²
2. **ä½¿ç”¨respondText**: ä½¿ç”¨`respondText`è€Œä¸æ˜¯`respondHtml`
3. **æ˜ç¡®å­—ç¬¦é›†**: åœ¨ContentTypeä¸­æ˜ç¡®æŒ‡å®š`withCharset(Charsets.UTF_8)`

### ä»£ç è§£æ

```kotlin
val htmlContent = kotlinx.html.stream.createHTML().html {
    generateMainPage()  // è¿™é‡Œç”ŸæˆHTMLå†…å®¹
}
// htmlContentç°åœ¨æ˜¯ä¸€ä¸ªUTF-8ç¼–ç çš„HTMLå­—ç¬¦ä¸²

call.respondText(
    htmlContent,  // å‘é€HTMLå­—ç¬¦ä¸²
    ContentType.Text.Html.withCharset(Charsets.UTF_8)  // æ˜ç¡®æŒ‡å®šå­—ç¬¦é›†
)
```

---

## å¦‚æœè¿˜æœ‰é—®é¢˜

### æ£€æŸ¥1ï¼šæŸ¥çœ‹HTTPå“åº”å¤´

åœ¨æµè§ˆå™¨ä¸­æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼š
1. åˆ‡æ¢åˆ°Networkæ ‡ç­¾
2. åˆ·æ–°é¡µé¢
3. ç‚¹å‡»ç¬¬ä¸€ä¸ªè¯·æ±‚ï¼ˆé€šå¸¸æ˜¯ `/`ï¼‰
4. æŸ¥çœ‹Response Headers

**åº”è¯¥çœ‹åˆ°**ï¼š
```
Content-Type: text/html; charset=UTF-8
```

### æ£€æŸ¥2ï¼šæŸ¥çœ‹HTMLæºä»£ç 

åœ¨æµè§ˆå™¨ä¸­æŒ‰F12ï¼š
1. åˆ‡æ¢åˆ°Elementsæ ‡ç­¾
2. æŸ¥çœ‹`<head>`æ ‡ç­¾
3. åº”è¯¥çœ‹åˆ°ï¼š`<meta charset="UTF-8">`

### æ£€æŸ¥3ï¼šæ¸…é™¤æµè§ˆå™¨ç¼“å­˜

**å½»åº•æ¸…é™¤**ï¼š
```
1. Ctrl + Shift + Delete
2. é€‰æ‹©"å…¨éƒ¨æ—¶é—´"
3. å‹¾é€‰"ç¼“å­˜çš„å›¾åƒå’Œæ–‡ä»¶"
4. ç‚¹å‡»"æ¸…é™¤æ•°æ®"
```

æˆ–è€…ä½¿ç”¨**æ— ç—•æ¨¡å¼**ï¼š
```
Ctrl + Shift + N (Chrome/Edge)
```

### æ£€æŸ¥4ï¼šç¡®è®¤åº”ç”¨ç‰ˆæœ¬

```bash
# æŸ¥çœ‹APKä¿®æ”¹æ—¶é—´
ls -lh app/build/outputs/apk/debug/app-debug.apk

# åº”è¯¥æ˜¯æœ€æ–°çš„æ—¶é—´æˆ³
```

---

## æµ‹è¯•å¯¼å…¥åŠŸèƒ½

ä¿®å¤åå¯ä»¥æµ‹è¯•CSVå¯¼å…¥ï¼š

### 1. è®¿é—®å¯¼å…¥é¡µé¢
```
http://[è®¾å¤‡IP]:8080/import
```

### 2. ä¸Šä¼ test_recipes.csv

ç‚¹å‡»"é€‰æ‹©æ–‡ä»¶" â†’ é€‰æ‹©`test_recipes.csv` â†’ ç‚¹å‡»"ä¸Šä¼ å¯¼å…¥"

### 3. æŸ¥çœ‹ç»“æœ

**æˆåŠŸæç¤ºåº”è¯¥æ˜¾ç¤º**ï¼š
- "å¯¼å…¥æˆåŠŸ"
- "æˆåŠŸ: 10 æ¡"
- "å¤±è´¥: 0 æ¡"

### 4. éªŒè¯é…æ–¹åˆ—è¡¨

è®¿é—®ï¼š`http://[è®¾å¤‡IP]:8080/recipes`

åº”è¯¥èƒ½çœ‹åˆ°ï¼š
- WEB001 - Webæµ‹è¯•-è‹¹æœé¦™ç²¾
- WEB002 - Webæµ‹è¯•-è‰è“é¦™ç²¾
- ... ç­‰10æ¡é…æ–¹

### 5. Androidåº”ç”¨éªŒè¯

1. æ‰“å¼€SmartDosingåº”ç”¨
2. è¿›å…¥"é…æ–¹ç®¡ç†"
3. æœç´¢"Webæµ‹è¯•"
4. åº”è¯¥èƒ½çœ‹åˆ°è¿™10æ¡é…æ–¹

---

## å®Œæ•´æµ‹è¯•æµç¨‹

```bash
# 1. å¸è½½å¹¶é‡æ–°å®‰è£…
adb uninstall com.example.smartdosing
adb install app/build/outputs/apk/debug/app-debug.apk

# 2. è·å–è®¾å¤‡IP
adb shell ip -f inet addr show wlan0 | findstr "inet"

# 3. æ‰“å¼€æµè§ˆå™¨æµ‹è¯•
# è®¿é—® http://[IP]:8080

# 4. æµ‹è¯•æ‰€æœ‰é¡µé¢çš„ä¸­æ–‡æ˜¾ç¤º
# - é¦–é¡µ: /
# - å¯¼å…¥: /import
# - é…æ–¹: /recipes
# - ç»Ÿè®¡: /stats

# 5. æµ‹è¯•å¯¼å…¥åŠŸèƒ½
# ä¸Šä¼  test_recipes.csv

# 6. éªŒè¯æ•°æ®åŒæ­¥
# åœ¨Androidåº”ç”¨ä¸­æŸ¥çœ‹å¯¼å…¥çš„é…æ–¹
```

---

## æŠ€æœ¯å¯¹æ¯”

### æ–¹æ³•1: respondHtmlï¼ˆæ— æ•ˆï¼‰
```kotlin
// âŒ è¿™ç§æ–¹å¼æ— æ³•æ§åˆ¶å­—ç¬¦é›†
call.respondHtml {
    generateMainPage()
}
```

### æ–¹æ³•2: è®¾ç½®header + respondHtmlï¼ˆæ— æ•ˆï¼‰
```kotlin
// âŒ headerä¼šè¢«respondHtmlè¦†ç›–
call.response.header(HttpHeaders.ContentType, "text/html; charset=UTF-8")
call.respondHtml {
    generateMainPage()
}
```

### æ–¹æ³•3: createHTML + respondTextï¼ˆæœ‰æ•ˆï¼‰âœ…
```kotlin
// âœ… å®Œå…¨æ§åˆ¶å­—ç¬¦é›†
val htmlContent = kotlinx.html.stream.createHTML().html {
    generateMainPage()
}
call.respondText(htmlContent, ContentType.Text.Html.withCharset(Charsets.UTF_8))
```

---

## æ€»ç»“

**æ ¹æœ¬åŸå› **: Ktorçš„`respondHtml`ä¸æ”¯æŒè‡ªå®šä¹‰å­—ç¬¦é›†

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨`createHTML` + `respondText` + æ˜ç¡®æŒ‡å®šUTF-8å­—ç¬¦é›†

**ä¿®æ”¹èŒƒå›´**: 5ä¸ªHTMLè·¯ç”±ï¼ˆ/ã€/recipesã€/importã€/statsã€/templatesï¼‰

**æ„å»ºçŠ¶æ€**: BUILD SUCCESSFUL âœ…

**æ–°APKä½ç½®**: `app/build/outputs/apk/debug/app-debug.apk`

---

**è¯·é‡æ–°å®‰è£…åº”ç”¨ï¼Œä¸­æ–‡æ˜¾ç¤ºé—®é¢˜å°†å½»åº•è§£å†³ï¼** ğŸ‰

å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·ï¼š
1. å®Œå…¨å¸è½½æ—§åº”ç”¨
2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
3. ä½¿ç”¨æ— ç—•æ¨¡å¼è®¿é—®
4. æŸ¥çœ‹HTTPå“åº”å¤´ç¡®è®¤å­—ç¬¦é›†

---

**æ›´æ–°æ—¶é—´**: 2024-11-24
**ä¿®å¤ç‰ˆæœ¬**: v2.1
**æµ‹è¯•çŠ¶æ€**: å¾…éªŒè¯
